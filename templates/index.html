<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>noteプロンプト生成フォーム</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .hidden { display: none; }
    </style>
    <script>
        // 「その他」選択時に入力欄を表示する関数
        function toggleOther(selectElem, targetId) {
            const otherField = document.getElementById(targetId);
            if (!otherField) return;
            const inputs = otherField.querySelectorAll("input, textarea");
            if (selectElem.value === "その他") {
                otherField.classList.remove("hidden");
                inputs.forEach(input => input.required = true);
            } else {
                otherField.classList.add("hidden");
                inputs.forEach(input => {
                    input.value = "";
                    input.required = false;
                });
            }
        }

        // ページロード時に「その他」が選択されていた場合に表示
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll("select[data-other-target]").forEach(sel => {
                const targetId = sel.getAttribute("data-other-target");
                toggleOther(sel, targetId);
            });
        });
    </script>
</head>
<body>
<h1>note プロンプト自動生成フォーム（その他自由記述）</h1>
<form id="promtForm" method="POST" action="{{ url_for('generate') }}" target="result_frame">

       <!-- 著者の環境・アピールポイント -->
    <div class="section">
        <h2>著者の環境・アピールポイント（任意）</h2>

<label>どの目線で記事を書くか:</label>
<select name="author_viewpoint" onchange="toggleOther(this,'author_viewpoint_other')">
    <option value="" selected>選択なし</option>
    <option value="会社員目線">会社員目線</option>
    <option value="経営者目線">経営者目線</option>
    <option value="フリーランス目線">フリーランス目線</option>
    <option value="エンジニア目線">エンジニア目線</option>
    <option value="学生目線">学生目線</option>
    <option value="専門家目線">専門家目線</option>
    <option value="その他">その他</option>
</select>

<div id="author_viewpoint_other" class="hidden">
    <input type="text" name="author_viewpoint_other_input" class="other-input" placeholder="視点・立場を入力">
</div>

        <label>著者としてのアピールポイント・経験:</label>
        <select name="author_strengths" onchange="toggleOther(this,'author_strengths_other')">
            <option value="" selected>選択なし</option>
            <option value="教育経験が豊富">教育経験が豊富</option>
            <option value="実務経験がある">実務経験がある</option>
            <option value="副業／起業経験あり">副業／起業経験あり</option>
            <option value="執筆経験がある">執筆経験がある</option>
            <option value="心理学やコーチングの知見あり">心理学やコーチングの知見あり</option>
            <option value="その他">その他</option>
        </select>
        <div id="author_strengths_other" class="hidden">
            <input type="text" name="author_strengths_other_input" class="other-input" placeholder="アピールポイントを入力">
        </div>

        <!-- 著者名 -->
        <h2>著者名</h2>
        <input type="text" id="author_name" name="author_name" placeholder="例: Taro">

 <!-- 記事に含めるかのチェック -->
<div class="form-check checkbox-card">
    <input type="checkbox" id="author_name_include" name="author_name_include" value="yes">
    <label for="author_name_include">これらの情報を記事に含めてもよい</label>
</div>

    </div>



<!-- ペルソナ -->
<div class="section" style="padding: 20px; margin: auto; font-family: sans-serif; line-height: 1.6;">
    <h2 style="border-bottom: 2px solid #ccc; padding-bottom: 10px;">
        ペルソナ（記事の読者像） <span class="recommended" >入力推奨</span>


    <!-- 年齢 -->
    <div class="persona-block">
        <label class="recommended">読者の年齢層（最も多い層）:</label>
        <select name="persona_age" onchange="toggleOther(this,'persona_age_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="10代">10代</option>
            <option value="20代">20代</option>
            <option value="30代">30代</option>
            <option value="40代">40代</option>
            <option value="50代以上">50代以上</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_age_other" class="hidden">
            <input type="text" name="persona_age_other_input" placeholder="具体的な年齢層">
        </div>
    </div>

    <!-- 性別 -->
    <div class="persona-block">
        <label class="recommended">読者の性別（記事作成時の考慮）:</label>
        <select name="persona_gender" required>
            <option value="" selected disabled>選択してください</option>
            <option value="男性">男性</option>
            <option value="女性">女性</option>
            <option value="その他">その他（多様な性別）</option>
            <option value="無回答">無回答（性別を限定しない）</option>
        </select>
    </div>

    <!-- 職業 -->
    <div class="persona-block">
        <label class="recommended">読者の職業・属性（検索意図判断に重要）:</label>
        <select name="persona_job" onchange="toggleOther(this,'persona_job_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="学生">学生</option>
            <option value="会社員">会社員／社会人</option>
            <option value="フリーランス／副業">フリーランス／副業</option>
            <option value="公務員">公務員</option>
            <option value="主婦／主夫">主婦／主夫</option>
            <option value="クリエイター／ライター">クリエイター／ライター</option>
            <option value="ITエンジニア">ITエンジニア／技術職</option>
            <option value="心理学者">心理学者</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_job_other" class="hidden">
            <input type="text" name="persona_job_other_input" placeholder="具体的な職業">
        </div>
    </div>

    <!-- 興味・趣味 -->
    <div class="persona-block">
        <label class="recommended">読者が普段興味を持つテーマ:</label>
        <select name="persona_hobby" onchange="toggleOther(this,'persona_hobby_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="読書">読書</option>
            <option value="プログラミング">プログラミング</option>
            <option value="副業">副業</option>
            <option value="投資・お金">投資・お金</option>
            <option value="健康・ダイエット">健康・ダイエット</option>
            <option value="メンタルヘルス／セルフケア">メンタルヘルス／セルフケア</option>
            <option value="学習／資格">学習／資格</option>
            <option value="ライフスタイル改善">ライフスタイル改善</option>
            <option value="旅行／ライフログ">旅行／ライフログ</option>
            <option value="心理学">心理学</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_hobby_other" class="hidden">
            <input type="text" name="persona_hobby_other_input" placeholder="興味・趣味を具体的に入力">
        </div>
    </div>

    <!-- 悩み -->
    <div class="persona-block">
        <label class="recommended">読者の現在の悩み（最も大きな課題）:</label>
        <select name="persona_pain" onchange="toggleOther(this,'persona_pain_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="時間がない／忙しい">時間がない／忙しい（時短ニーズ）</option>
            <option value="スキルが足りない">スキル不足（学習ニーズ）</option>
            <option value="モチベーション維持が難しい">モチベ維持が難しい</option>
            <option value="健康・体調管理">健康・体調管理の悩み</option>
            <option value="将来の不安／キャリア">キャリア不安（転職・将来）</option>
            <option value="習慣化できない">習慣化できない</option>
            <option value="情報が多すぎる／整理したい">情報が多すぎて整理できない</option>
            <option value="自己肯定感が低い">自己肯定感が低い</option>
            <option value="ストレス軽減したい">ストレスを減らしたい</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_pain_other" class="hidden">
            <input type="text" name="persona_pain_other_input" placeholder="悩みを具体的に入力">
        </div>
    </div>

    <!-- ゴール -->
    <div class="persona-block">
        <label class="recommended">読者がこの記事を読む目的（達成したい未来）:</label>
        <select name="persona_goal" onchange="toggleOther(this,'persona_goal_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="スキルアップ／資格取得">スキルアップ／資格取得</option>
            <option value="副業を始めたい">副業を始めたい</option>
            <option value="習慣化したい">習慣化したい</option>
            <option value="健康を維持／改善したい">健康維持・改善</option>
            <option value="人生の方向性を見つけたい">人生の方向性を見つけたい</option>
            <option value="時間を有効活用したい">時間の有効活用</option>
            <option value="経済的余裕を得たい">経済的余裕を得たい</option>
            <option value="自己理解を深めたい">自己理解を深めたい</option>
            <option value="精神的に安定したい">精神的な安定</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_goal_other" class="hidden">
            <input type="text" name="persona_goal_other_input" placeholder="ゴールを具体的に入力">
        </div>
    </div>

    <!-- 知識レベル -->
    <div class="persona-block">
        <label class="recommended">読者の知識レベル（記事難易度調整用）:</label>
        <select name="persona_level" onchange="toggleOther(this,'persona_level_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="初心者（基礎から知りたい）">初心者（基礎から知りたい）</option>
            <option value="中級者（ある程度経験あり）">中級者（ある程度経験あり）</option>
            <option value="上級者（専門的な内容を求めている）">上級者（専門的な内容を求めている）</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_level_other" class="hidden">
            <input type="text" name="persona_level_other_input" placeholder="知識レベルを具体的に入力">
        </div>
    </div>

    <!-- 現在の状況 -->
    <div class="persona-block">
        <label class="recommended">読者の現在の状況（行動文脈用）:</label>
        <select name="persona_situation" onchange="toggleOther(this,'persona_situation_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="就活／転職活動中">就活／転職活動中</option>
            <option value="フルタイム勤務で忙しい">フルタイム勤務で忙しい</option>
            <option value="子育て中で時間が少ない">子育て中で時間が少ない</option>
            <option value="副業を模索している">副業を模索している</option>
            <option value="長期的に時間がない状況">長期的に忙しい（慢性的）</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_situation_other" class="hidden">
            <input type="text" name="persona_situation_other_input" placeholder="状況を具体的に入力">
        </div>
    </div>

    <!-- 過去の失敗経験 -->
    <div class="persona-block">
        <label class="recommended">過去に試したが続かなかった／失敗したこと:</label>
        <select name="persona_failed" onchange="toggleOther(this,'persona_failed_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="継続できなかった">継続できなかった</option>
            <option value="行動したが成果が出なかった">行動したが成果が出なかった</option>
            <option value="情報が多く混乱した">情報が多く混乱した</option>
            <option value="何から始めればいいか分からなかった">何から始めればいいか分からなかった</option>
            <option value="特に行動していない">特に行動していない</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_failed_other" class="hidden">
            <input type="text" name="persona_failed_other_input" placeholder="失敗内容を具体的に入力">
        </div>
    </div>

    <!-- 恐れていること -->
    <div class="persona-block">
        <label class="recommended">読者が最も恐れていること（不安の核心）:</label>
        <select name="persona_fear" onchange="toggleOther(this,'persona_fear_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="このまま成長できないこと">このまま成長できない</option>
            <option value="時間だけが浪費されること">時間だけが溶ける</option>
            <option value="周りに取り残されること">周りに置いていかれる</option>
            <option value="お金の不安が続くこと">お金の不安が続く</option>
            <option value="努力が報われないこと">努力が無駄になる</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_fear_other" class="hidden">
            <input type="text" name="persona_fear_other_input" placeholder="不安を具体的に入力">
        </div>
    </div>

    <!-- 生活スタイル -->
    <div class="persona-block" style="margin-bottom: 20px;">
        <label class="recommended">読者の生活スタイル（現実的提案のため）:</label>
        <select name="persona_life" onchange="toggleOther(this,'persona_life_other')" required>
            <option value="" selected disabled>選択してください</option>
            <option value="フルタイム勤務">フルタイム勤務</option>
            <option value="パート・アルバイト勤務">パート・アルバイト勤務</option>
            <option value="夜型の生活">夜型の生活</option>
            <option value="朝型の生活">朝型の生活</option>
            <option value="週末にしか時間が取れない">週末だけ時間が取れる</option>
            <option value="1日30分なら時間が作れる">1日30分なら作業可能</option>
            <option value="その他">その他（具体的に入力）</option>
        </select>
        <div id="persona_life_other" class="hidden">
            <input type="text" name="persona_life_other_input" placeholder="生活スタイルを具体的に入力">
        </div>
    </div>
</div>


    <!-- 記事テーマ -->
    <div class="section">
        <h2>記事テーマ <span class="recommended" >入力推奨</span></h2>
        <label class="recommended">主題:</label>
        <input type="text" name="article_main" placeholder="例：短期間で英語力を上げる勉強法" required>

        <label class="recommended">記事タイプ:</label>
        <select name="article_type" onchange="toggleOther(this,'article_type_other')" data-other-target="article_type_other" required>
            <option value="" selected disabled>選択してください</option>
            <option value="How-to／ノウハウ">How-to／ノウハウ</option>
            <option value="解説／知識共有">解説／知識共有</option>
            <option value="経験談／体験談">経験談／体験談</option>
            <option value="レビュー">レビュー</option>
            <option value="コラム／エッセイ">コラム／エッセイ</option>
            <option value="考察／分析">考察／分析</option>
            <option value="インタビュー風">インタビュー風</option>
            <option value="まとめ記事／チェックリスト">まとめ記事／チェックリスト</option>
            <option value="その他">その他</option>
        </select>
        <div id="article_type_other" class="hidden"><input type="text" name="article_type_other_input" placeholder="記事タイプを入力"></div>
    </div>

    <!-- 記事目的 -->
    <div class="section">
        <h2>記事目的・価値 <span class="recommended" >入力推奨</span></h2>
        <label class="recommended">記事の目的:</label>
        <select name="article_purpose" onchange="toggleOther(this,'article_purpose_other')" data-other-target="article_purpose_other" required>
            <option value="" selected disabled>選択してください</option>
            <option value="情報提供／知識共有">情報提供／知識共有</option>
            <option value="自己表現・思考整理">自己表現・思考整理</option>
            <option value="副業収益化／販売">副業収益化／有料記事販売</option>
            <option value="ブランディング／信頼構築">ブランディング／信頼構築</option>
            <option value="SNS拡散／拡散狙い">SNS拡散／拡散狙い</option>
            <option value="コミュニティ形成">コミュニティ形成</option>
            <option value="自己振り返り">自己振り返り</option>
            <option value="その他">その他</option>
        </select>
        <div id="article_purpose_other" class="hidden"><input type="text" name="article_purpose_other_input" placeholder="記事目的を入力"></div>

        <label>読者への価値・伝えたいこと:</label>
        <textarea name="article_value" placeholder="例：勉強法を理解させ、行動を促す"></textarea>

        <label>CTA（読者にしてほしい行動）:</label>
        <textarea name="article_cta" placeholder="例：教材購入リンクをクリック"></textarea>
    </div>

    <!-- トーン・文体 -->
    <div class="section">
        <h2>トーン・文体 <span class="recommended" >入力推奨</span></h2>
        <label class="recommended">文体:</label>
        <select name="tone_style" onchange="toggleOther(this,'tone_style_other')" data-other-target="tone_style_other" required>
            <option value="" selected disabled>選択してください</option>
            <option value="丁寧／優しい">丁寧／優しい</option>
            <option value="カジュアル／フレンドリー">カジュアル／フレンドリー</option>
            <option value="論理的／専門的">論理的／専門的</option>
            <option value="親しみやすい／読みやすい">親しみやすい／読みやすい</option>
            <option value="熱量高め／情熱的">熱量高め／情熱的</option>
            <option value="ゆるふわ／リラックス">ゆるふわ／リラックス</option>
            <option value="真面目／真摯">真面目／真摯</option>
            <option value="ユーモア／ラフ">ユーモア／ラフ</option>
            <option value="その他">その他</option>
        </select>
        <div id="tone_style_other" class="hidden"><input type="text" name="tone_style_other_input" placeholder="文体を入力"></div>

        <label>自由補足（任意）:</label>
        <textarea name="tone_keywords" placeholder="例：初心者でも理解できる優しい表現"></textarea>
    </div>

<!-- ===========================================
   ▼ 段落テンプレート（改善版・AI/手動制御付き）
=========================================== -->
<div class="section">
    <h2>段落テンプレート（ドラッグ＆自由編集対応）</h2>

    <label style="font-weight:600; margin-bottom:4px; display:block;">
        使用するテンプレートを選択
    </label>
    <select id="template_select" name="article_headings_template">
        <option value="" selected>選択なし</option>
        <option value="howto">HowTo型 - 課題提示 → 手順 → 実践</option>
        <option value="analysis">分析型 - 現状分析 → 課題整理 → 解決策提示</option>
        <option value="practice">実践型 - 導入 → 実践例 → 学び</option>
        <option value="result">成果型 - 方法提示 → 実践 → 応用</option>
        <option value="empathy">共感型 - きっかけ → 経験 → 学び</option>
        <option value="other">空テンプレ（自由追加）</option>
    </select>

    <p style="font-size:13px;color:#555; margin:6px 0 12px;">
        テンプレを選ぶとステップが自動追加されます。<br>
        各ステップでは「AI自動生成」と「手動」を切り替え可能です。
    </p>

    <div style="
        margin:12px 0;
        padding:12px;
        border:1px dashed #ddd;
        border-radius:6px;
        background:#fff;
    ">
        <label style="font-weight:600; display:block; margin-bottom:6px;">
            記事全体の文章構成（どれか1つ選択）
        </label>

        <label style="display:block; margin:6px 0;">
            <input type="radio" name="framework" value="ストーリーテリング法：導入→葛藤→解決→結論の流れ" checked>
            <strong>ストーリーテリング</strong>
            <span style="color:#555; font-size:13px;">（導入 → 葛藤 → 解決 → 結論で読みやすさUP）</span>
        </label>

        <label style="display:block; margin:6px 0;">
            <input type="radio" name="framework" value="PREP法：Point→Reason→Example→Point">
            <strong>PREP法</strong>
            <span style="color:#555; font-size:13px;">（結論 → 理由 → 具体例 → 再結論、ロジカルに伝わる）</span>
        </label>

        <label style="display:block; margin:6px 0;">
            <input type="radio" name="framework" value="AID法：Attention→Interest→Desire→Action">
            <strong>AIDA</strong>
            <span style="color:#555; font-size:13px;">
                （Attention → Interest → Desire → Action、行動につながる文章）
            </span>
        </label>

        <label style="display:block; margin:6px 0;">
            <input type="radio" name="framework" value="生成段階でAIが最適構成を判断">
            <strong>指定なし</strong>
            <span style="color:#555; font-size:13px;">（生成段階でAIが最適構成を判断）</span>
        </label>
    </div>

    <div id="steps_container"></div>

    <div style="display:flex; gap:8px; margin-top:12px;">
        <button type="button" id="add_step_btn">＋ ステップを追加</button>
        <button type="button" id="auto_fill_btn">テンプレから自動反映</button>
    </div>
</div>

<!-- SortableJSライブラリ -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
// =========================
// ▼ テンプレ定義
// =========================
const stepTemplates = {
    howto: ["Hook（問題提起）","Why（背景・重要性）","Goal（目標）","準備（チェックリスト）","手順：ステップ1","手順：ステップ2","実践例（ケース）","よくあるミスと対処","まとめ（行動喚起）"],
    analysis: ["Hook（問題提起）","現状データの提示","課題の本質","要因の深掘り","解決案","推奨案","リスクと注意点","まとめ"],
    practice: ["導入（共感）","準備と前提","実践ステップ","結果と分析","改善案","応用例","まとめ"],
    result: ["導入（期待値）","方法の全体像","手順","実例","応用","注意点","まとめ"],
    empathy: ["きっかけ","経験談","問題直面","試行錯誤","結果","学び","まとめ"],
    other: []
};

const stepPurposes = [
    { value:"hook", label:"Hook（注意喚起）" },
    { value:"problem", label:"Problem（課題）" },
    { value:"insight", label:"Insight（分析/洞察）" },
    { value:"howto", label:"How-to（手順）" },
    { value:"example", label:"Example（具体例）" },
    { value:"pitfall", label:"Pitfall（失敗・注意）" },
    { value:"cta", label:"CTA（行動提案）" },
    { value:"summary", label:"Summary（まとめ）" }
];

const stepPurposesStatic = {
    howto: ["hook","insight","howto","howto","howto","howto","example","pitfall","summary"],
    analysis: ["hook","insight","insight","insight","howto","howto","pitfall","summary"],
    practice: ["hook","insight","howto","insight","insight","example","summary"],
    result: ["hook","insight","howto","example","howto","pitfall","summary"],
    empathy: ["hook","example","problem","insight","insight","example","summary"],
    other: []
};

const templateSelect = document.getElementById("template_select");
const stepsContainer = document.getElementById("steps_container");
const addStepBtn = document.getElementById("add_step_btn");
const autoFillBtn = document.getElementById("auto_fill_btn");

// =========================
// ▼ ステップ追加（AI/手動切替・ドラッグ対応）
// =========================
function addStep(title="", purpose="") {
    const uid = crypto.randomUUID();

    const wrap = document.createElement("div");
    wrap.className = "step-item";
    wrap.style = `
        border:1px solid #ddd;
        padding:14px;
        margin:14px 0;
        border-radius:6px;
        background:#fafafa;
        cursor: grab;
    `;

    wrap.innerHTML = `
        <div class="drag-handle" style="font-weight:600; cursor:grab; margin-bottom:6px;">☰ 段落をドラッグして並び替え</div>
        <label style="font-size:13px;font-weight:600;">① 段落見出し（AI自動／手動）</label>
        <div style="margin-top:6px;">
            <label><input type="radio" name="mode_${uid}" value="auto" checked> AIで生成する</label>
            <label style="margin-left:16px;"><input type="radio" name="mode_${uid}" value="manual"> 手動で入力</label>
        </div>
        <input type="text" class="manual-input hidden" name="article_headings[]" placeholder="手動で見出しを入力" style="width:100%;padding:6px;margin-top:6px;">
        <input type="hidden" class="auto-value" name="article_headings_auto[]" value="${title}">
        <hr style="margin:14px 0;">
        <label style="font-size:13px;font-weight:600;">② この段落の役割（Purpose）</label>
        <select name="article_purposes[]" style="width:100%;padding:6px;margin-top:6px;">
            <option value="">選択してください</option>
            ${stepPurposes.map(p =>
                `<option value="${p.value}" ${p.value===purpose ? "selected" : ""}>${p.label}</option>`
            ).join("")}
        </select>
        <label style="font-size:13px;font-weight:600;margin-top:14px;display:block;">③ 段落生成手法（PREP/AIDAなど）</label>
        <select name="article_method_suggest[]" style="width:100%;padding:6px;margin-top:6px;">
            <option value="">記事全体の設定に従う</option>
            <option value="story">ストーリーテリング</option>
            <option value="prep">PREP</option>
            <option value="aida">AIDA</option>
            <option value="bullet">箇条書き</option>
        </select>
        <button type="button" class="remove-step" style="margin-top:14px;background:#e63946;color:white;padding:6px 10px;border:none;border-radius:4px;">削除</button>
    `;

    const radios = wrap.querySelectorAll(`input[name="mode_${uid}"]`);
    const manualInput = wrap.querySelector(".manual-input");

    radios.forEach(r => {
        r.addEventListener("change", () => {
            manualInput.classList.toggle("hidden", r.value !== "manual");
        });
    });

    wrap.querySelector(".remove-step").onclick = () => wrap.remove();

    stepsContainer.appendChild(wrap);
}

// =========================
// ▼ テンプレ選択時（静的 Purpose 適用）
// =========================
templateSelect.addEventListener("change", () => {
    stepsContainer.innerHTML = "";
    const type = templateSelect.value;
    if (!type) return;

    const titles = stepTemplates[type];
    const purposes = stepPurposesStatic[type];

    titles.forEach((step, i) => addStep(step, purposes[i] || ""));
});

// =========================
// ▼ 自動反映（静的 Purpose 適用）
// =========================
autoFillBtn.onclick = () => {
    const type = templateSelect.value;
    if (!type) return alert("テンプレートを選んでください");

    stepsContainer.innerHTML = "";
    const titles = stepTemplates[type];
    const purposes = stepPurposesStatic[type];

    titles.forEach((step, i) => addStep(step, purposes[i] || ""));
};

// =========================
// ▼ 手動追加ボタン
// =========================
addStepBtn.onclick = () => addStep("", "");

// =========================
// ▼ ドラッグ並び替え（SortableJS）
// =========================
Sortable.create(stepsContainer, {
    animation: 150,
    handle: ".drag-handle",   // ハンドル部分だけでドラッグ
    ghostClass: "sortable-ghost"
});
</script>







   <!-- 文字量（必須） -->
<div class="section">
    <h2>文字量<span class="recommended" >入力推奨</span></h2>
    <label class="recommended">希望文字数:</label>
    <select name="constraint_length" required>
        <option value="" selected disabled>選択してください</option>
        <option value="～1000字">～1000字</option>
        <option value="1000～3000字">1000～3000字</option>
        <option value="3000～7000字">3000～7000字</option>
        <option value="7000～12000字">7000～12000字</option>
        <option value="12000字以上">12000字以上</option>
    </select>
    <p class="note">※記事作成に必須の情報です。未選択では送信できません。</p>
</div>


<!-- ===========================================
   ▼ SEO入力フォーム（改善版）
=========================================== -->
<div class="section">
    <h2>SEO情報<span class="recommended" >入力推奨</span></h2>

    <!-- SEOキーワード -->
    <label for="seo_keywords">SEOキーワード 
        <span class="note">(検索上位を意識した複数キーワード、カンマ区切り可)</span>
    </label>
    <textarea id="seo_keywords" name="constraint_seo" placeholder="例：英語学習, TOEIC, 短期習得" rows="2" style="width:100%; padding:6px;"></textarea>

<!-- SEOターゲット層（単一選択） -->
<label for="seo_audience" style="margin-top:12px; display:block;">
    ターゲット層（想定読者） <span class="note">(単一選択、迷ったら「その他」を選択)</span>
</label>
<select id="seo_audience" name="seo_audience" style="width:100%; padding:6px;">
    <option value="" selected>選択してください</option>
    <option value="student">学生（高校・大学生）</option>
    <option value="working_adult">社会人（会社員・会社員志向）</option>
    <option value="freelancer">フリーランス</option>
    <option value="entrepreneur">起業家・経営者</option>
    <option value="beginner">初心者向け（入門者）</option>
    <option value="intermediate">中級者向け（経験者）</option>
    <option value="advanced">上級者向け（熟練者）</option>
    <option value="parent">保護者・家庭向け</option>
    <option value="hobbyist">趣味・自己啓発目的</option>
    <option value="other">その他（下記に自由記入）</option>
</select>

<input type="text" id="seo_audience_other" name="seo_audience_other" placeholder="その他のターゲット層を入力" style="width:100%; margin-top:6px; padding:6px;">

<!-- 想定検索意図（ラジオ＋自由記述） -->
<label style="margin-top:12px; display:block;">想定する検索意図</label>
<div style="margin-top:6px;">
    <label><input type="radio" name="search_intent" value="informational" checked> 情報収集型（例：ノウハウ・解説）</label><br>
    <label><input type="radio" name="search_intent" value="transactional"> 取引/購入型（例：商品・サービス紹介）</label><br>
    <label><input type="radio" name="search_intent" value="navigational"> ナビゲーション型（例：特定サイト/ページ検索）</label><br>
    <label><input type="radio" name="search_intent" value="educational"> 教育/学習型（例：資格勉強・スキルアップ）</label><br>
    <label><input type="radio" name="search_intent" value="comparison"> 比較/レビュー型（例：商品・サービス比較）</label><br>
    <label><input type="radio" name="search_intent" value="other"> その他：</label>
    <input type="text" name="search_intent_other" placeholder="具体的に記入" style="width:80%; margin-top:6px; padding:6px;">
</div>


</div>

<script>
// 「その他」を入力可能にする制御
const audienceSelect = document.getElementById("seo_audience");
const audienceOther = document.getElementById("seo_audience_other");

audienceSelect.addEventListener("change", () => {
    if ([...audienceSelect.selectedOptions].some(opt => opt.value === "other")) {
        audienceOther.style.display = "block";
    } else {
        audienceOther.style.display = "none";
        audienceOther.value = "";
    }
});
</script>

<div class="section">
     <h2>補助情報（任意）</h2>
    <label>参考記事・URL（複数可）:</label>
    <div id="reference_container">
        <input type="text" name="extra_reference[]" placeholder="参考記事のURLを入力">
    </div>
    <button type="button" onclick="addReference()">＋追加</button>

    <label>記事に必ず含めたい要素・具体例:</label>
    <textarea name="must_include" placeholder="例：実践例、表や図、著者の体験談"></textarea>

    <label>記事に避けたい表現・トーン:</label>
    <textarea name="avoid_tone" placeholder="例：専門用語だらけ、攻撃的表現"></textarea>
</div>

<script>
function addReference() {
    const container = document.getElementById("reference_container");
    const input = document.createElement("input");
    input.type = "text";
    input.name = "extra_reference[]";
    input.placeholder = "参考記事のURLを入力";
    container.appendChild(input);
}
</script>

</form>
<!-- 自動送信スクリプト -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("promtForm");
    if (!form) return;

    let submitTimeout = null;

    function triggerSubmit() {
        if (submitTimeout) clearTimeout(submitTimeout);
        submitTimeout = setTimeout(() => {
            form.submit(); // targetがあるのでiframe内だけ更新される
            submitTimeout = null;
        }, 500);
    }

    form.querySelectorAll("select, input[type=text], textarea").forEach(elem => {
        elem.addEventListener("change", triggerSubmit);
        elem.addEventListener("input", triggerSubmit);
    });
});

</script>



</body>
</html>
